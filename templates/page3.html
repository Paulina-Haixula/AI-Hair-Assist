{% if request.args.get('returning') %}
    <input type="hidden" name="returning_user" value="1">
{% endif %}

{% extends "layout.html" %}
{% block content %}

<div class="container mt-5">
<!-- PAGE TITLE -->
    <div class="text-center mb-4">
      <div class="d-inline-block px-4 py-2 rounded-4 shadow-sm"
           style="background: rgba(255,255,255,0.85);">
        <h1 class="fw-bold mb-0">Survey</h1>
      </div>
    </div>
  <!-- PROGRESS BAR -->
  <div class="mb-4">
    <div class="progress" style="height: 22px;">
      <div class="progress-bar bg-primary"
           role="progressbar"
           style="width: 50%;">
        Step 2 of 4
      </div>
    </div>
  </div>

  <div class="card p-5 shadow-lg"
       style="max-width:900px; margin:auto; background: rgba(255,255,255,0.95);">

    <h2 class="mb-3 text-center">Step 2 — Hair Characteristics</h2>
    <p class="text-center text-muted mb-4">
      These characteristics help personalize moisture balance, styling,
      breakage prevention, and product selection.
    </p>

    <form method="post">
      <div class="row g-4">

        <!-- HAIR TYPE -->
        <div class="col-md-3">
          <label class="form-label fw-semibold">
            Hair Type
            <button type="button" class="info-btn"
                    data-bs-toggle="collapse"
                    data-bs-target="#hairTypeHelp">
              ℹ️
            </button>
          </label>

          <div class="collapse info-box" id="hairTypeHelp">
            <small>
              Curl pattern classification:
              <br><strong>1</strong> Straight
              <br><strong>2</strong> Wavy
              <br><strong>3</strong> Curly
              <br><strong>4</strong> Coily
            </small>

            <!-- Visual guide -->
            <div class="mt-2 text-center">
              <img src="{{ url_for('static', filename='images/hair_types_chart.png') }}"
                   alt="Hair Type Chart"
                   class="img-fluid rounded border"
                   style="max-height:120px;">
            </div>
          </div>

          <select name="hair_type" class="form-control">
            <option value="">-- Select Hair Type --</option>
            {% for t in ['1a','1b','1c','2a','2b','2c','3a','3b','3c','4a','4b','4c'] %}
              <option value="{{ t }}"
                {% if survey.hair_type == t %}selected{% endif %}>
                {{ t }}
              </option>
            {% endfor %}
          </select>
        </div>

        <!-- POROSITY -->
        <div class="col-md-3">
          <label class="form-label fw-semibold">
            Hair Porosity
            <button type="button" class="info-btn"
                    data-bs-toggle="collapse"
                    data-bs-target="#porosityHelp">
              ℹ️
            </button>
          </label>

          <div class="collapse info-box" id="porosityHelp">
            <small>
              Describes how easily hair absorbs and retains moisture.
              <br><strong>Low:</strong> Product buildup
              <br><strong>Medium:</strong> Balanced moisture
              <br><strong>High:</strong> Loses moisture quickly
            </small>
          </div>

          <select name="hair_porosity" class="form-control">
            <option value="">-- Select Porosity --</option>
            {% for p in ['Low','Medium','High'] %}
              <option value="{{ p }}"
                {% if survey.hair_porosity == p %}selected{% endif %}>
                {{ p }}
              </option>
            {% endfor %}
          </select>
        </div>

        <!-- TEXTURE -->
        <div class="col-md-3">
          <label class="form-label fw-semibold">
            Hair Texture
            <button type="button" class="info-btn"
                    data-bs-toggle="collapse"
                    data-bs-target="#textureHelp">
              ℹ️
            </button>
          </label>

          <div class="collapse info-box" id="textureHelp">
            <small>
              Refers to strand thickness.
              <br><strong>Fine:</strong> Fragile, lightweight
              <br><strong>Medium:</strong> Balanced
              <br><strong>Coarse:</strong> Strong, resistant
            </small>
          </div>

          <select name="hair_texture" class="form-control">
            <option value="">-- Select Texture --</option>
            {% for t in ['Fine','Medium','Coarse'] %}
              <option value="{{ t }}"
                {% if survey.hair_texture == t %}selected{% endif %}>
                {{ t }}
              </option>
            {% endfor %}
          </select>
        </div>

        <!-- DENSITY -->
        <div class="col-md-3">
          <label class="form-label fw-semibold">
            Hair Density
            <button type="button" class="info-btn"
                    data-bs-toggle="collapse"
                    data-bs-target="#densityHelp">
              ℹ️
            </button>
          </label>

          <div class="collapse info-box" id="densityHelp">
            <small>
              Number of strands per scalp area.
              <br><strong>Low:</strong> Scalp visible
              <br><strong>Medium:</strong> Balanced
              <br><strong>High:</strong> Full volume
            </small>
          </div>

          <select name="hair_density" class="form-control">
            <option value="">-- Select Density --</option>
            {% for d in ['Low','Medium','High'] %}
              <option value="{{ d }}"
                {% if survey.hair_density == d %}selected{% endif %}>
                {{ d }}
              </option>
            {% endfor %}
          </select>
        </div>

      </div>

      <!-- NAVIGATION -->
      <div class="mt-5 d-flex justify-content-between">
        <a class="btn btn-secondary btn-lg" href="{{ url_for('survey.page2') }}">
          ⬅ Back
        </a>
        <button class="btn btn-primary btn-lg">
          Next ➡
        </button>
      </div>

    </form>
  </div>
</div>

<!-- AUTO-COLLAPSE SCRIPT -->
<script>
  document.querySelectorAll('.info-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.info-box').forEach(box => {
        if (!btn.dataset.bsTarget.includes(box.id)) {
          bootstrap.Collapse.getOrCreateInstance(box, { toggle: false }).hide();
        }
      });
    });
  });
</script>

<style>
  .info-btn {
    border: none;
    background: none;
    cursor: pointer;
    font-size: 0.9rem;
  }

  .info-box {
    background: #f8f9fa;
    padding: 10px;
    border-radius: 8px;
    margin-bottom: 8px;
  }
</style>

{% endblock %}
