{% extends "layout.html" %}
{% block content %}

{% if request.args.get('returning') %}
<input type="hidden" name="returning_user" value="1">
{% endif %}

<div class="card p-5 shadow-lg mt-4" style="max-width:900px; margin:auto; background: rgba(255,255,255,0.95); border-radius:12px;">

    <!-- Navigation Buttons -->
    <div class="d-flex justify-content-between mb-3">
        <a href="{{ url_for('home') }}" class="btn btn-secondary btn-sm">ğŸ  Home</a>
        <a href="{{ url_for('logout') }}" class="btn btn-danger btn-sm">ğŸšª Logout</a>
    </div>

    <h2 class="text-center mb-2" style="font-weight:700;">âœ¨ Personalized Haircare Report</h2>

    <p class="text-center text-muted mb-4">
        <strong>Survey ID:</strong> {{ survey.survey_id }} |
        <strong>Generated:</strong> {{ survey.timestamp or survey.created_at or "N/A" }}
    </p>

    <!-- MODEL OUTPUT SECTION -->
    <h3 class="mt-4">ğŸ“Œ Model Predictions</h3>
    <p class="text-muted">These are the detected conditions based on your survey answers and AI classification.</p>

    <div class="row">
        {% for key, val in result.labels.items() %}
        <div class="col-md-6 mt-3">
            <div class="p-3 rounded shadow-sm" style="background:#f8f9fa;">
                <h5>{{ key|capitalize }} Result</h5>
                <p style="font-size:17px;"><strong>{{ val }}</strong></p>
            </div>
        </div>
        {% endfor %}
    </div>

    <hr class="mt-5 mb-4">

    <!-- BREAKAGE -->
    <h3>ğŸ’¥ Breakage Recommendation</h3>
    <div class="p-3 rounded shadow-sm mb-4" style="background:#eef8ff;">
        <p><strong>Result:</strong> {{ result.labels.breakage }}</p>
        <p><strong>Why this matters:</strong> {{ result.recommendations.breakage.Why }}</p>
        <p><strong>Recommended Action:</strong> {{ result.recommendations.breakage.Recommendation }}</p>

        <!-- Explanation -->
        <p class="mt-2 text-muted"><em>
            This recommendation focuses on improving strand strength and reducing breakage over time.
            Maintaining moisture balance, reducing stress, and following the routine will gradually restore hair integrity.
        </em></p>
    </div>

    <!-- DISEASE -->
    <h3>ğŸ©º Scalp Disease Assessment</h3>
    <div class="p-3 rounded shadow-sm mb-4" style="background:#ffecec;">
        <p><strong>Detected Condition:</strong> {{ result.labels.disease }}</p>
        <p><strong>Why this occurs:</strong> {{ result.recommendations.disease.Why }}</p>
        <p><strong>Recommendation:</strong> {{ result.recommendations.disease.Recommendation }}</p>

        <!-- Explanation -->
        <p class="mt-2 text-muted"><em>
            This section highlights potential scalp issues based on symptoms detected.
            Following the advice early can prevent progression and support healthier regrowth.
        </em></p>
    </div>

    <!-- CURRENT HAIR CONDITION (DNN INGREDIENT-BASED) -->
    <h3>ğŸ§  Current Hair Condition & Ingredient Guidance</h3>
    <p class="text-muted">
        AI analyzed ingredient effectiveness patterns â€” choose products containing these components to support your hair type.
    </p>

    <div class="p-3 rounded shadow-sm mb-4" style="background:#f4fff0;">
        {% for category, items in result.recommendations.dnn.items() %}
        <div class="mt-3">
            <h5 style="text-transform:capitalize;">{{ category.replace("_"," ") }}</h5>
            <ul>
                {% for item in items %}
                <li>{{ item.Ingredient }} â€” <strong>Score:</strong> {{ item.Score }}</li>
                {% endfor %}
            </ul>
        </div>
        {% endfor %}

        <!-- Explanation -->
        <p class="mt-2 text-muted"><em>
            Higher score means a more suitable ingredient for your current condition.
            Look for products listing these in the top half of the ingredient list for best results.
        </em></p>
    </div>

    <!-- POROSITY RESULTS -->
    <h3>ğŸ’§ Porosity Care Guide</h3>
    <div class="p-3 rounded shadow-sm" style="background:#fff7e6;">
        <p><strong>Detected Porosity:</strong> {{ result.labels.porosity|capitalize }}</p>
        <p>{{ result.recommendations.porosity.description }}</p>

        <h5 class="mt-3">Recommended Products:</h5>
        <ul>
            {% for product in result.recommendations.porosity.recommended_products %}
            <li>{{ product }}</li>
            {% endfor %}
        </ul>

        <h5 class="mt-3">Care Tips:</h5>
        <ul>
            {% for tip in result.recommendations.porosity.care_tips %}
            <li>{{ tip }}</li>
            {% endfor %}
        </ul>

        <!-- Explanation -->
        <p class="mt-2 text-muted"><em>
            Porosity guides how your hair absorbs and retains moisture.
            Following these tips helps maintain hydration balance and reduce frizz or dryness.
        </em></p>
    </div>

    <hr class="my-4">

    <!-- Summary -->
    <div class="alert alert-success text-center p-4" style="font-size:18px;">
        ğŸŒ¿ <strong>Summary:</strong><br>
        This personalized routine combines AI predictions with expert rules.
        Implement product suggestions, follow porosity care, and ingredients guide for visible improvement.
    </div>

    <div class="text-center mt-4">
        <a href="{{ url_for('home') }}" class="btn btn-primary btn-lg">ğŸ”™ Return Home</a>
        <a href="{{ url_for('logout') }}" class="btn btn-danger btn-lg ms-2">Logout</a>
    </div>

</div>

{% endblock %}
